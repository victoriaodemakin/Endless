!(function(r){"use strict";var s,i,e,t,d=window.MasterAddonsData||{};(i={ModalLayoutView:null,ModalHeaderView:null,ModalHeaderInsertButton:null,ModalLoadingView:null,ModalBodyView:null,ModalErrorView:null,LibraryCollection:null,KeywordsModel:null,ModalCollectionView:null,ModalTabsCollection:null,ModalTabsCollectionView:null,FiltersCollectionView:null,FiltersItemView:null,ModalTabsItemView:null,ModalTemplateItemView:null,ModalInsertTemplateBehavior:null,ModalTemplateModel:null,CategoriesCollection:null,ModalPreviewView:null,ModalHeaderBack:null,ModalHeaderLogo:null,MasterProButton:null,KeywordsView:null,TabModel:null,CategoryModel:null,init:function(){var l=this;(l.ModalTemplateModel=Backbone.Model.extend({defaults:{template_id:0,name:"",title:"",thumbnail:"",preview:"",source:"",categories:[],keywords:[],liveUrl:"",package:""}})),(l.ModalHeaderView=Marionette.LayoutView.extend({id:"ma-el-template-modal-header",template:"#views-ma-el-template-modal-header",ui:{closeModal:"#ma-el-template-modal-header-close-modal"},events:{"click @ui.closeModal":"onCloseModalClick"},regions:{headerLogo:"#ma-el-template-modal-header-logo-area",headerTabs:"#ma-el-template-modal-header-tabs",headerActions:"#ma-el-template-modal-header-actions"},onCloseModalClick:function(){s.closeModal()},})),(l.TabModel=Backbone.Model.extend({defaults:{slug:"",title:""}})),(l.LibraryCollection=Backbone.Collection.extend({model:l.ModalTemplateModel})),(l.ModalTabsCollection=Backbone.Collection.extend({model:l.TabModel})),(l.CategoryModel=Backbone.Model.extend({defaults:{slug:"",title:""}})),(l.KeywordsModel=Backbone.Model.extend({defaults:{keywords:{}}})),(l.CategoriesCollection=Backbone.Collection.extend({model:l.CategoryModel})),(l.KeywordsView=Marionette.ItemView.extend({id:"elementor-template-library-filter",template:"#views-ma-el-template-modal-keywords",ui:{keywords:".ma-el-library-keywords"},events:{"change @ui.keywords":"onSelectKeyword"},onSelectKeyword:function(e){var t=e.currentTarget.selectedOptions[0].value;s.setFilter("keyword",t)},onRender:function(){this.$(".ma-el-library-keywords").select2({placeholder:"Choose a Widget",allowClear:!0,width:260})},})),(l.ModalPreviewView=Marionette.ItemView.extend({template:"#views-ma-el-template-modal-preview",id:"ma-el-item-preview-wrap",ui:{iframe:"iframe",notice:".ma-el-item-notice"},onRender:function(){if(null!==this.getOption("notice")&&this.getOption("notice").length){var e="";-1!==this.getOption("notice").indexOf("facebook")?(e+="<p>Please login with your Facebook account in order to get your Facebook Reviews.</p>"):-1!==this.getOption("notice").indexOf("google")?(e+="<p>You need to add your Google API key from Dashboard -> Master Addons for Elementor -> Google Maps</p>"):-1!==this.getOption("notice").indexOf("form")&&(e+="<p>You need to have <a href='https://wordpress.org/plugins/contact-form-7/' target='_blank'>Contact Form 7 plugin</a> installed and active.</p>"),this.ui.notice.html("<div><p><strong>Important!</strong></p>"+e+"</div>")}
this.ui.iframe.attr("src",this.getOption("url"))},})),(l.ModalHeaderBack=Marionette.ItemView.extend({template:"#views-ma-el-template-modal-header-back",id:"ma-el-template-modal-header-back",ui:{button:"button"},events:{"click @ui.button":"onBackClick"},onBackClick:function(){s.setPreview("back")},})),(l.ModalHeaderLogo=Marionette.ItemView.extend({template:"#views-ma-el-template-modal-header-logo",id:"ma-el-template-modal-header-logo"})),(l.ModalBodyView=Marionette.LayoutView.extend({template:"#views-ma-el-template-modal-content",id:"ma-el-template-library-content",className:function(){return"library-tab-"+s.getTab()},regions:{contentTemplates:".ma-el-templates-list",contentFilters:".ma-el-filters-list",contentKeywords:".ma-el-keywords-list"},})),(l.LibraryLoadingView=Marionette.ItemView.extend({id:"ma-el-modal-template-library-loading",template:"#views-ma-el-template-modal-loading"})),(l.LibraryErrorView=Marionette.ItemView.extend({id:"ma-el-modal-template-error",template:"#views-ma-el-template-modal-error"})),(l.ModalInsertTemplateBehavior=Marionette.Behavior.extend({ui:{insertButton:".ma-el-template-insert"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){var t=this.view.model,e=t.attributes.dependencies,a=t.attributes.pro,o=Object.keys(e).length,n={};if((s.layout.showLoadingView(),0<o))for(var i in e)r.ajax({url:ajaxurl,type:"post",dataType:"json",data:{action:"ma_el_inner_template",template:e[i],tab:s.getTab()}});"valid"!==d.license.status&&a?s.layout.showLicenseError():elementor.templates.requestTemplateContent(t.get("source"),t.get("template_id"),{data:{tab:s.getTab(),page_settings:!1},success:function(e){e.license?(console.log("%c Template Inserted Successfully!!","color: #7a7a7a; background-color: #eee;"),s.closeModal(),elementor.channels.data.trigger("$e.run( 'document/import' )",t),null!==s.atIndex&&(n.at=s.atIndex),(elementor.config.version<'3.0.0')?elementor.sections.currentView.addChildModel(e.content,n):elementor.previewView.addChildModel(e.content,n),elementor.channels.data.trigger("template:after:insert",t),(s.atIndex=null)):s.layout.showLicenseError()},error:function(e){console.log(e)},})},})),(l.ModalHeaderInsertButton=Marionette.ItemView.extend({template:"#views-ma-el-template-modal-insert-button",id:"ma-el-template-modal-insert-button",behaviors:{insertTemplate:{behaviorClass:l.ModalInsertTemplateBehavior}},})),(l.MasterProButton=Marionette.ItemView.extend({template:"#views-ma-el-template-pro-button",id:"ma-el-modal-template-pro-button"})),(l.ModalTemplateItemView=Marionette.ItemView.extend({template:"#views-ma-el-template-modal-item",className:function(){var e=" ma-el-modal-template-has-url",t="";return(""===this.model.get("preview")&&(e=" ma-el-modal-template-no-url"),this.model.get("pro")&&"valid"!=d.license.status&&(t=" ma-el-modal-template-pro"),"elementor-template-library-template elementor-template-library-template-remote"+e+t)},ui:function(){return{previewButton:".elementor-template-library-template-preview"}},events:function(){return{"click @ui.previewButton":"onPreviewButtonClick"}},onPreviewButtonClick:function(){""!==this.model.get("url")&&s.setPreview(this.model)},behaviors:{insertTemplate:{behaviorClass:l.ModalInsertTemplateBehavior}},})),(l.FiltersItemView=Marionette.ItemView.extend({template:"#views-ma-el-template-modal-filters-item",className:function(){return"ma-el-modal-template-filter-item"},ui:function(){return{filterLabels:".ma-el-modal-template-filter-label"}},events:function(){return{"click @ui.filterLabels":"onFilterClick"}},onFilterClick:function(e){var t=jQuery(e.target);jQuery(".ma-el-library-keywords").val(""),s.setFilter("category",t.val()),s.setFilter("keyword","")},})),(l.ModalTabsItemView=Marionette.ItemView.extend({template:"#views-ma-el-template-modal-tabs-item",className:function(){return"elementor-template-library-menu-item"},ui:function(){return{tabsLabels:"label",tabsInput:"input"}},events:function(){return{"click @ui.tabsLabels":"onTabClick"}},onRender:function(){this.model.get("slug")===s.getTab()&&this.ui.tabsInput.attr("checked","checked")},onTabClick:function(e){var t=jQuery(e.target);s.setTab(t.val()),s.setFilter("keyword","")},})),(l.FiltersCollectionView=Marionette.CompositeView.extend({id:"ma-el-modal-template-library-filters",template:"#views-ma-el-template-modal-filters",childViewContainer:"#ma-el-modal-filters-container",getChildView:function(e){return l.FiltersItemView},})),(l.ModalTabsCollectionView=Marionette.CompositeView.extend({template:"#views-ma-el-template-modal-tabs",childViewContainer:"#views-ma-el-template-modal-tabs-items",initialize:function(){this.listenTo(s.channels.layout,"tamplate:cloned",this._renderChildren)},getChildView:function(e){return l.ModalTabsItemView},})),(l.ModalCollectionView=Marionette.CompositeView.extend({template:"#views-ma-el-template-modal-templates",id:"ma-el-modal-template-library-templates",childViewContainer:"#ma-el-modal-templates-container",initialize:function(){this.listenTo(s.channels.templates,"filter:change",this._renderChildren)},filter:function(e){var t=s.getFilter("category"),a=s.getFilter("keyword");return(!t&&!a)||(a&&!t?_.contains(e.get("keywords"),a):t&&!a?_.contains(e.get("categories"),t):_.contains(e.get("categories"),t)&&_.contains(e.get("keywords"),a))},getChildView:function(e){return l.ModalTemplateItemView},onRenderCollection:function(){var e=this.$childViewContainer,t=this.$childViewContainer.children(),a=s.getTab();"master_page"!==a&&"local"!==a&&e.imagesLoaded(function(){}).done(function(){setTimeout(function(){l.masonry.init({container:e,items:t})},200)})},})),(l.ModalLoadingView=Marionette.ItemView.extend({id:"ma-el-modal-loading",template:"#views-ma-el-template-modal-loading"})),(l.ModalErrorView=Marionette.ItemView.extend({id:"ma-el-modal-loading",template:"#views-ma-el-template-modal-error"})),(l.ModalLayoutView=Marionette.LayoutView.extend({el:"#ma-el-modal-template",regions:d.modalRegions,initialize:function(){this.getRegion("modalHeader").show(new l.ModalHeaderView()),this.listenTo(s.channels.tabs,"filter:change",this.switchTabs),this.listenTo(s.channels.layout,"preview:change",this.switchPreview)},switchTabs:function(){this.showLoadingView(),s.setFilter("keyword",""),s.requestTemplates(s.getTab())},switchPreview:function(){var e=this.getHeaderView(),t=s.getPreview(),a=s.getFilter("category"),o=s.getFilter("keyword");return"back"===t?(e.headerLogo.show(new l.ModalHeaderLogo()),e.headerTabs.show(new l.ModalTabsCollectionView({collection:s.collections.tabs})),e.headerActions.empty(),s.setTab(s.getTab()),""!=a&&(s.setFilter("category",a),jQuery("#ma-el-modal-filters-container").find("input[value='"+a+"']").prop("checked",!0)),void(""!=o&&s.setFilter("keyword",o))):"initial"===t?(e.headerActions.empty(),void e.headerLogo.show(new l.ModalHeaderLogo())):(this.getRegion("modalContent").show(new l.ModalPreviewView({preview:t.get("preview"),url:t.get("url"),notice:t.get("notice")})),e.headerLogo.empty(),e.headerTabs.show(new l.ModalHeaderBack()),void e.headerActions.show(new l.ModalHeaderInsertButton({model:t})))},getHeaderView:function(){return this.getRegion("modalHeader").currentView},getContentView:function(){return this.getRegion("modalContent").currentView},showLoadingView:function(){this.modalContent.show(new l.ModalLoadingView())},showLicenseError:function(){this.modalContent.show(new l.ModalErrorView())},showTemplatesView:function(e,t,a){this.getRegion("modalContent").show(new l.ModalBodyView());var o=this.getContentView(),n=this.getHeaderView(),i=new l.KeywordsModel({keywords:a});(s.collections.tabs=new l.ModalTabsCollection(s.getTabs())),n.headerTabs.show(new l.ModalTabsCollectionView({collection:s.collections.tabs})),o.contentTemplates.show(new l.ModalCollectionView({collection:e})),o.contentFilters.show(new l.FiltersCollectionView({collection:t})),o.contentKeywords.show(new l.KeywordsView({model:i}))},}))},masonry:{self:{},elements:{},init:function(e){var t=this;(t.settings=r.extend(t.getDefaultSettings(),e)),(t.elements=t.getDefaultElements()),t.run()},getSettings:function(e){return e?this.settings[e]:this.settings},getDefaultSettings:function(){return{container:null,items:null,columnsCount:3,verticalSpaceBetween:30}},getDefaultElements:function(){return{$container:jQuery(this.getSettings("container")),$items:jQuery(this.getSettings("items"))}},run:function(){var r=[],s=this.elements.$container.position().top,d=this.getSettings(),m=d.columnsCount;(s+=parseInt(this.elements.$container.css("margin-top"),10)),this.elements.$container.height(""),this.elements.$items.each(function(e){var t=Math.floor(e/m),a=e%m,o=jQuery(this),n=o.position(),i=o[0].getBoundingClientRect().height+d.verticalSpaceBetween;if(t){var l=n.top-s-r[a];(l-=parseInt(o.css("margin-top"),10)),(l*=-1),o.css("margin-top",l+"px"),(r[a]+=i)}else r.push(i)}),this.elements.$container.height(Math.max.apply(Math,r))},},}),(s={modal:!(t={getDataToSave:function(e){return(e.id=window.elementor.config.post_id),e},init:function(){window.elementor.settings.master_template&&(window.elementor.settings.master_template.getDataToSave=this.getDataToSave),window.elementor.settings.master_page&&((window.elementor.settings.master_page.getDataToSave=this.getDataToSave),(window.elementor.settings.master_page.changeCallbacks={custom_header:function(){this.save(function(){elementor.reloadPreview(),elementor.once("preview:loaded",function(){elementor.getPanelView().setPage("master_page_settings")})})},custom_footer:function(){this.save(function(){elementor.reloadPreview(),elementor.once("preview:loaded",function(){elementor.getPanelView().setPage("master_page_settings")})})},}))},}),layout:!(e={MasterSearchView:null,init:function(){(this.MasterSearchView=window.elementor.modules.controls.BaseData.extend({onReady:function(){var e=this.model.attributes.action,t=this.model.attributes.query_params;this.ui.select.find("option").each(function(e,t){r(this).attr("selected",!0)}),this.ui.select.select2({ajax:{url:function(){var a="";return(0<t.length&&r.each(t,function(e,t){window.elementor.settings.page.model.attributes[t]&&(a+="&"+t+"="+window.elementor.settings.page.model.attributes[t])}),ajaxurl+"?action="+e+a)},dataType:"json",},placeholder:"Please enter 3 or more characters",minimumInputLength:3,})},onBeforeDestroy:function(){this.ui.select.data("select2")&&this.ui.select.select2("destroy"),this.$el.remove()},})),window.elementor.addControlView("master_search",this.MasterSearchView)},}),collections:{},tabs:{},defaultTab:"",channels:{},atIndex:null,init:function(){window.elementor.on("preview:loaded",window._.bind(s.onPreviewLoaded,s)),i.init(),e.init(),t.init()},onPreviewLoaded:function(){var e=this,t=setInterval(function(){e.initMasterTempsButton(),0<window.elementor.$previewContents.find(".elementor-add-new-section").length&&clearInterval(t)},100);window.elementor.$previewContents.on("click.addMasterTemplate",".ma-el-add-section-btn",_.bind(this.showTemplatesModal,this)),(this.channels={templates:Backbone.Radio.channel("MASTER_EDITOR:templates"),tabs:Backbone.Radio.channel("MASTER_EDITOR:tabs"),layout:Backbone.Radio.channel("MASTER_EDITOR:layout")}),(this.tabs=d.tabs),(this.defaultTab=d.defaultTab)},initMasterTempsButton:function(){var e=window.elementor.$previewContents.find(".elementor-add-new-section"),t='<div class="elementor-add-section-area-button ma-el-add-section-btn"><div class="jltma-editor-icon"></div></div>';e.length&&d.MasterAddonsEditorBtn&&r(t).prependTo(e),window.elementor.$previewContents.on("click.addMasterTemplate",".elementor-editor-section-settings .elementor-editor-element-add",function(){var e=r(this).closest(".elementor-top-section"),a=e.data("model-cid");if(elementor.config.version<'3.0.0'){window.elementor.sections.currentView.collection.length&&r.each(window.elementor.sections.currentView.collection.models,function(e,t){a===t.cid&&(s.atIndex=e)})}else{elementor.previewView.collection.length&&r.each(elementor.previewView.collection.models,function(e,t){a===t.cid&&(s.atIndex=e)})}
d.MasterAddonsEditorBtn&&e.prev(".elementor-add-section").find(".elementor-add-new-section").prepend(t)})},getFilter:function(e){return this.channels.templates.request("filter:"+e)},setFilter:function(e,t){this.channels.templates.reply("filter:"+e,t),this.channels.templates.trigger("filter:change")},getTab:function(){return this.channels.tabs.request("filter:tabs")},setTab:function(e,t){this.channels.tabs.reply("filter:tabs",e),t||this.channels.tabs.trigger("filter:change")},getTabs:function(){var a=[];return(_.each(this.tabs,function(e,t){a.push({slug:t,title:e.title})}),a)},getPreview:function(e){return this.channels.layout.request("preview")},setPreview:function(e,t){this.channels.layout.reply("preview",e),t||this.channels.layout.trigger("preview:change")},getKeywords:function(){return(_.each(this.keywords,function(e,t){tabs.push({slug:t,title:e})}),[])},showTemplatesModal:function(){this.getModal().show(),this.layout||((this.layout=new i.ModalLayoutView()),this.layout.showLoadingView()),this.setTab(this.defaultTab,!0),this.requestTemplates(this.defaultTab),this.setPreview("initial")},requestTemplates:function(o){var n=this,e=n.tabs[o];n.setFilter("category",!1),e.data.templates&&e.data.categories?n.layout.showTemplatesView(e.data.templates,e.data.categories,e.data.keywords):r.ajax({url:ajaxurl,type:"get",dataType:"json",data:{action:"ma_el_get_templates",tab:o},success:function(e){var t=new i.LibraryCollection(e.data.templates),a=new i.CategoriesCollection(e.data.categories);(n.tabs[o].data={templates:t,categories:a,keywords:e.data.keywords}),n.layout.showTemplatesView(t,a,e.data.keywords)},})},closeModal:function(){this.getModal().hide()},getModal:function(){return this.modal||(this.modal=elementor.dialogsManager.createWidget("lightbox",{id:"ma-el-modal-template",className:"elementor-templates-modal",closeButton:!1})),this.modal},}),r(window).on("elementor:init",s.init)})(jQuery)